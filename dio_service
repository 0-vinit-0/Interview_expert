import 'dart:io';
import 'package:dio/dio.dart';

class DioService {
  // ✅ Singleton instance
  static final DioService _instance = DioService._internal();
  factory DioService() => _instance;
  DioService._internal() {
    _initDio();
  }

  late final Dio dio;

  void _initDio() {
    final options = BaseOptions(
      baseUrl: "https://api.yourdomain.com", // ✅ CHANGE THIS
      connectTimeout: const Duration(seconds: 20),
      receiveTimeout: const Duration(seconds: 20),
      sendTimeout: const Duration(seconds: 20),
      headers: {
        "Accept": "application/json",
        "Content-Type": "application/json",
      },
    );

    dio = Dio(options);

    // ✅ Interceptors
    dio.interceptors.add(
      InterceptorsWrapper(
        onRequest: (options, handler) {
          // ✅ Add token dynamically if needed
          final token = _getToken(); // Implement your token logic
          if (token != null) {
            options.headers["Authorization"] = "Bearer $token";
          }

          print("➡️ ${options.method} ${options.uri}");
          print("Headers: ${options.headers}");
          print("Body: ${options.data}");

          return handler.next(options);
        },
        onResponse: (response, handler) {
          print("✅ ${response.statusCode} ${response.data}");
          return handler.next(response);
        },
        onError: (DioException e, handler) {
          print("❌ ERROR [${e.response?.statusCode}] ${e.message}");
          return handler.next(e);
        },
      ),
    );
  }

  // ✅ Token Getter (Optional)
  String? _getToken() {
    // TODO: Fetch from SharedPreferences / SecureStorage
    return null;
  }

  // ✅ ========== GET ==========
  Future<Response> get(
    String endpoint, {
    Map<String, dynamic>? query,
  }) async {
    return await dio.get(endpoint, queryParameters: query);
  }

  // ✅ ========== POST ==========
  Future<Response> post(
    String endpoint, {
    dynamic body,
    Map<String, dynamic>? query,
  }) async {
    return await dio.post(endpoint, data: body, queryParameters: query);
  }

  // ✅ ========== PUT ==========
  Future<Response> put(
    String endpoint, {
    dynamic body,
    Map<String, dynamic>? query,
  }) async {
    return await dio.put(endpoint, data: body, queryParameters: query);
  }

  // ✅ ========== DELETE ==========
  Future<Response> delete(
    String endpoint, {
    dynamic body,
    Map<String, dynamic>? query,
  }) async {
    return await dio.delete(endpoint, data: body, queryParameters: query);
  }
}


final res = await DioService().post(
  "/login",
  body: {
    "email": "test@gmail.com",
    "password": "123456",
  },
);
print(res.data);
